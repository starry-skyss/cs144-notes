# 经验总结（Lessons Learned）

本文档总结我完成 Stanford CS144 Networking Lab（check0/1/2/3/5/6）的主要收获，并说明这些能力如何迁移到后续分布式/存储方向（Raft + LSM-Tree KV）项目中（公开笔记，不含实验解答代码/实现片段）。

---

## 1. 我在 CS144 中训练到的核心能力

### 1.1 将“规范/接口”落地为可运行系统
CS144 的核心训练是：在给定接口与测试要求的前提下，把协议行为落地为可运行的模块，并通过严格测试套件验收。  
这与真实工程非常接近：很多系统工作并非“发明算法”，而是将规则实现正确、实现稳定、实现可验证。

对应实验模块：
- Reassembler：将“乱序/重叠/重复/容量约束”落地
- TCP Receiver/Sender：把 ACK/窗口/重传等行为落实到状态机
- ARP/Router：将“二层解析 + 三层选路/TTL 转发规则”实现为可观测系统

---

### 1.2 用“不变量（Invariant）”组织正确性
相比“凭感觉写代码”，CS144 更有效的方法是用不变量描述正确性，并围绕不变量定位 bug：

- 连续前缀不变量（Reassembler）：有 gap 不输出；只输出可连续拼接前缀
- 序列号映射不变量（Receiver）：wrap/unwrap 必须稳定、ACK 必须基于连续拼接位置
- 窗口与 in-flight 不变量（Sender）：in-flight 受窗口约束；非法 ACK 必须忽略
- 选路与 TTL 不变量（Router）：最长前缀匹配（LPM）必须选最具体路由；TTL 到期必须丢弃

这类思维方式在后续分布式系统中价值很大，因为分布式系统的错误往往不是“语法错”，而是“不变量被破坏”。

---

### 1.3 工程化调试能力
CS144 大量时间用于定位“边界/时序/状态机”问题，这逼迫我建立系统化调试流程：

- 以官方测试用例最小化复现
- 使用 sanitizer 捕获内存/未定义行为
- 用 tcpdump/Wireshark 确认协议现象与时序（ARP、转发）
- 使用最小日志只记录关键状态量（窗口、ACK、计时器、缓存命中、TTL）

我得到的经验是：系统类项目真正拉开差距的是“能不能稳定定位问题并验证修复”，而不是“能不能把代码写出来”。

---

### 1.4 面向验收与可复现的开发习惯
CS144 的验收方式明确：**通过测试**。因此我逐渐形成了较强的工程习惯：

- 任何修改必须能复现问题、并在修复后消除
- 修复必须回归 checkpoint 全量测试（必要时再跑全量 test/speed）
- 尽量把“难以解释的 bug”转为可记录的状态量变化

这类习惯可以直接迁移到后续工程项目中，尤其是分布式系统。

---

## 2. 从 CS144 迁移到分布式/存储方向的能力映射

### 2.1 对 Raft 的迁移：状态机 + 超时 + 可验证
TCP Sender 的重传计时、Receiver 的 ACK 推进，以及 Router/ARP 的时序问题，本质上都是“状态机在时序约束下保持正确性”的问题，这与 Raft 非常相似：

- 都需要严格定义状态（leader/follower/candidate；或 sender/receiver）
- 都需要处理 timeout（选举超时、心跳；或重传超时）
- 都需要对异常场景做正确处理（丢包/乱序；或网络分区/宕机）

我在 CS144 里形成的方法论：
- 把状态与转移写清楚（能画出状态图/时序图）
- 用不变量约束行为（例如：日志匹配性质、leader 完整性）
- 使用“故障注入 + 回归测试”验证修复（kill leader / 网络延迟/丢包）

---

### 2.2 对 LSM-Tree / KV 的迁移：容量约束 + 一致性不变量
Reassembler 与 ByteStream 的能力迁移到 LSM/KV 非常自然：

- 容量约束：ByteStream 的 backpressure → memtable/缓存容量控制
- 连续性/正确性：连续前缀输出 → 写入路径顺序性与一致性检查
- 工程化验证：speed benchmark → KV 的吞吐与延迟评估

对应到 LSM/KV 项目中，我更倾向于：
- 从可跑 MVP 开始（Put/Get + WAL）
- 为 compaction、崩溃恢复建立可复现测试
- 用明确的不变量保障正确性（如：WAL/flush/compaction 的一致性）

---

## 3. 总结

完成 CS144（独立部分）对我来说最大的意义是提供了以下“可验证信号”：

- 具备系统模块化实现能力：Reassembler/TCP/ARP/Router
- 具备边界敏感度：乱序/重叠/窗口/回绕/TTL
- 具备验收意识：通过测试套件并形成可复现总结文档

---

## 4. 下一步计划

- 以 CS144 方法论推进毕设：用“状态机 + 不变量 + 测试/故障注入”驱动 Raft + LSM KV 的实现
- 优先实现可运行 MVP，再逐步增加：
  - 多副本一致性（Raft 日志复制）
  - 崩溃恢复与 WAL
  - compaction 策略与性能评估（benchmark + 指标）
- 形成可公开的工程作品集（自研 MiniRaft/MiniLSM/MiniKV），作为投递分布式/存储/后端岗位的主要项目证明